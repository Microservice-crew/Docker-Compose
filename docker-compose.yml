version: "3.7"

services:


  ################### DISCOVERY SERVER ( eureka) ###################
  Eureka:
    container_name: serviceregistry
    build: /eureka_server
    ports:
      - "8761:8761"
    hostname: serviceregistry
    image: erueka_service
    environment:
      - eureka.client.serviceUrl.defaultZone=http://serviceregistry:8761/eureka/

  ################### MICROSERVICES ###################
    Staff:
    container_name: staff
    image: "staff"
    build: .\Staff
    ports:
      - "8082:8082"   
    environment:
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://serviceregistry:8761/eureka/
    depends_on:
      - "Eureka"

   Car:
    container_name: CarServices
    image: "CarServices"
    build: .\CarServices
    ports:
      - "8083:8083"   
    environment:
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://serviceregistry:8761/eureka/
    depends_on:
      - "Eureka"
      
   
    Sponsor:
        container_name: SponsorServices
        image: "SponsorServices"
        build: .\SponsorServices
        ports:
          - "8084:8084"   
        environment:
          - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://serviceregistry:8761/eureka/
        depends_on:
          - "Eureka"
          
    Hotel:
        container_name: HotelServices
        image: "HotelServices"
        build: .\HotelServices
        ports:
          - "8085:8085"
        environment:
          - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://serviceregistry:8761/eureka/
        depends_on:
          - "Eureka"
   
   
    Flight:
        container_name: FlightServices
        image: "FlightServices"
        build: .\FlightServices
        ports:
          - "8086:8086"
        environment:
          - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://serviceregistry:8761/eureka/
        depends_on:
          - "Eureka"


 

  ################### GATEWAY SERVER  ###################
  gateway_service:
    container_name: gateway_server
    build: ./gateway-service
    image: gateway_service
    depends_on:
     - discovery_service
     - docker-mysql_1
     - docker-postgres
    ports:
      - "8089:8089"
    environment:
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://serviceregistry:8761/eureka/
      - EUREKA_INSTANCE_LEASERENEWALINTERVALINSECONDS=10
      - EUREKA_INSTANCE_LEASEEXPIRATIONDURATIONINSECONDS=30

      - SPRING_CLOUD_GATEWAY_ROUTES_0_ID=Mscustomerreview
      - SPRING_CLOUD_GATEWAY_ROUTES_0_URI=http://Mscustomerreview:8082
      - SPRING_CLOUD_GATEWAY_ROUTES_0_PREDICATES_0=Path=/api/feedback/**

      - SPRING_CLOUD_GATEWAY_ROUTES_1_ID=msinventorymanagement
      - SPRING_CLOUD_GATEWAY_ROUTES_1_URI=http://msinventorymanagement:8087
      - SPRING_CLOUD_GATEWAY_ROUTES_1_PREDICATES_0=Path=/api/item/**

      - SPRING_CLOUD_GATEWAY_ROUTES_2_ID=Msusermanagement
      - SPRING_CLOUD_GATEWAY_ROUTES_2_URI=http://Msusermanagement:7000
      - SPRING_CLOUD_GATEWAY_ROUTES_2_PREDICATES_0=Path=/**


