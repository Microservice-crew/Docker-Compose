version: "3.7"

services:


  ################### DISCOVERY SERVER ( eureka) ###################
  Eureka:
    container_name: serviceregistry
    build: /eureka_server
    ports:
      - "8761:8761"
    hostname: serviceregistry
    image: erueka_service
    environment:
      - eureka.client.serviceUrl.defaultZone=http://serviceregistry:8761/eureka/


       ################### BACKEND SERVER ###################
  Backend:
    container_name: backend
    build: /backend
    ports:
      - "3000:3000"
    image: backend
    environment:
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://serviceregistry:8761/eureka/
    depends_on:
      - Eureka

  ################### MICROSERVICES ###################
    Staff:
    container_name: staff
    image: "staff"
    build: .\Staff
    ports:
      - "8082:8082"   
    environment:
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://serviceregistry:8761/eureka/
    depends_on:
      - "Eureka"

   Car:
    container_name: CarServices
    image: "CarServices"
    build: .\CarServices
    ports:
      - "8083:8083"   
    environment:
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://serviceregistry:8761/eureka/
    depends_on:
      - "Eureka"
      
   
    Sponsor:
        container_name: SponsorServices
        image: "SponsorServices"
        build: .\SponsorServices
        ports:
          - "8084:8084"   
        environment:
          - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://serviceregistry:8761/eureka/
        depends_on:
          - "Eureka"
          
    Hotel:
        container_name: HotelServices
        image: "HotelServices"
        build: .\HotelServices
        ports:
          - "8085:8085"
        environment:
          - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://serviceregistry:8761/eureka/
        depends_on:
          - "Eureka"
   
   
    Flight:
        container_name: FlightService
        image: "FlightService"
        build: .\FlightService
        ports:
          - "8086:8086"
        environment:
          - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://serviceregistry:8761/eureka/
        depends_on:
          - "Eureka"


 

  ################### GATEWAY SERVER  ###################
  gateway_service:
    container_name: gateway_server
    build: ./gateway-service
    image: gateway_service
    depends_on:
     - discovery_service
     - docker-mysql_1
     - docker-postgres
    ports:
      - "8089:8089"
    environment:
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://serviceregistry:8761/eureka/
      - EUREKA_INSTANCE_LEASERENEWALINTERVALINSECONDS=10
      - EUREKA_INSTANCE_LEASEEXPIRATIONDURATIONINSECONDS=30

      - SPRING_CLOUD_GATEWAY_ROUTES_0_ID=Staff
      - SPRING_CLOUD_GATEWAY_ROUTES_0_URI=http://Staff:8082
      - SPRING_CLOUD_GATEWAY_ROUTES_0_PREDICATES_0=Path=/api/feedback/**

      - SPRING_CLOUD_GATEWAY_ROUTES_1_ID=Car
      - SPRING_CLOUD_GATEWAY_ROUTES_1_URI=http://Car:8083
      - SPRING_CLOUD_GATEWAY_ROUTES_1_PREDICATES_0=Path=/api/item/**
      
      - SPRING_CLOUD_GATEWAY_ROUTES_2_ID=Sponsor
      - SPRING_CLOUD_GATEWAY_ROUTES_2_URI=http://Sponsor:8084
      - SPRING_CLOUD_GATEWAY_ROUTES_2_PREDICATES_0=Path=/api/feedback/**

      - SPRING_CLOUD_GATEWAY_ROUTES_3_ID=Hotel
      - SPRING_CLOUD_GATEWAY_ROUTES_3_URI=http://Hotel:8085
      - SPRING_CLOUD_GATEWAY_ROUTES_3_PREDICATES_0=Path=/api/item/**

      - SPRING_CLOUD_GATEWAY_ROUTES_4_ID=Flight
      - SPRING_CLOUD_GATEWAY_ROUTES_4_URI=http://Flight:8086
      - SPRING_CLOUD_GATEWAY_ROUTES_4_PREDICATES_0=Path=/**



